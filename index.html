import requests
import pandas as pd
from prettytable import PrettyTable

# ? 請改成你自己的 ThingSpeak Channel ID
CHANNEL_ID = "3089514"

# ? ThingSpeak 公開資料 API（不需要 API key）
url = f"https://api.thingspeak.com/channels/{CHANNEL_ID}/feeds.json"

# 抓取資料
response = requests.get(url)
data = response.json()

# 取得 feeds
feeds = data.get("feeds", [])
if not feeds:
    print("?? 沒有找到 feeds 資料，請檢查頻道是否公開或有資料。")
else:
    # 轉成 DataFrame
    df = pd.DataFrame(feeds)
    
    # 檢查是否有 field1 欄位
    if "field1" in df.columns:
        df["學生"] = df["field1"].str.replace("到了", "")
    else:
        df["學生"] = "(未提供)"

    # 用 PrettyTable 美化輸出
    table = PrettyTable()
    table.field_names = ["編號", "學生"]

    for _, row in df.iterrows():
        table.add_row([row.get("entry_id", "-"), row["學生"]])

    print(f"?? 頻道名稱： {data.get('channel', {}).get('name', '未命名')}")
    print(table)
